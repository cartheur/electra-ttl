- name: My first play
  hosts: electra
  tasks:

  - name: Git checkout electra
    become: true
    become_user: electra
    ansible.builtin.git:
      repo: 'https://github.com/freegroup/electra.git'
      dest: /home/electra/server
      force: true
      update: true

  - name: Install packages in /author
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/author

  - name: Install packages in /brains
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/brains

  - name: Install packages in /circuit
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/circuit

  - name: Install packages in /common
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/common

  - name: Install packages in /designer
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/designer

  - name: Install packages in /home
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/home

  - name: Install packages in /ingress
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/ingress

  - name: Install packages in /permissions
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/permissions

  - name: Install packages in /shapes
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/shapes

  - name: Install packages in /sheets
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/sheets

  - name: Install packages in /userinfo
    become: true
    become_user: electra
    community.general.npm:
      path: /home/electra/server/userinfo

  - name: Build /author
    become: true
    become_user: electra
    command: npm run build
    args:
      chdir: /home/electra/server/author

  - name: Build /circuit
    become: true
    become_user: electra
    command: npm run build
    args:
      chdir: /home/electra/server/circuit

  - name: Build /designer
    become: true
    become_user: electra
    command: npm run build
    args:
      chdir: /home/electra/server/designer

  - name: Run the application
    become: true
    become_user: electra
    command: pm2 restart ./ecosystem.config.js
    args:
      chdir: /home/electra/server/
